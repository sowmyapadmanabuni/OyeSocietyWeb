<div class="container-fluid np">
    <div class="col-sm-12 mt-80">
        <!--Profile section-->
        <app-left-bar></app-left-bar>

        <!--Profile section-->

        <div class="col-xs-12 col-sm-12 col-md-11 b-l">

            <!--Dashboard icons start-->
            <div class="col-md-12 m-t-30 dash">
                <div class="enr-bt">
                        <div class="enroll">
                                <span class="purple">Blocks Management for {{globalService.getCurrentAssociationName()}}</span>                      
                        </div>
                        <div class="tab-opt">
                                <ul class="nav nav-pills">
                                    <li class="active"><a (click)="goToBlocks()">Blocks</a></li>
                                    <li><a (click)="goToUnits()">Units</a></li>
                                </ul>
                        </div>
                </div>
               




                



                <div *ngIf='enableBlockListView'>
                    <input type="text" [(ngModel)]="searchTxt" class="form-control" name="searchTxt"
                        placeholder="Search by Block Name, Block Type">
                </div>
                <div *ngIf='enableBlockListView' class="dropdown" style="display: flex;justify-content: space-between;align-items: baseline;">
                    <button class="btn btn-primary dropdown-toggle sdm br form-control" type="button"
                        data-toggle="dropdown" style="width:200px">{{(ShowRecords=='Show Records'?ShowRecords:setnoofrows)}}
                        <i aria-hidden="true" class="fa fa-angle-down fa-1x"></i></button>
                    <ul class="dropdown-menu fullw" style="width:200px">
                        <li *ngFor='let rows of rowsToDisplay' (click)="setRows(rows['Row'])">
                            <a>{{rows['Display']}}</a></li>
                    </ul>
                    <div style="display: flex;justify-content: flex-end;flex-direction: column;">
                        <button class="btn-primary-purple" (click)="addBlocksShow()">
                                <i class="fa fa-plus" aria-hidden="true"></i> Add Blocks</button>
                        <div class="upload_excel">
                          <a class="excel" (click)="NavigateToBulkUpload()" tooltip="Have more num of Blocks?">Bulk Upload</a>
                           <!-- <a  href="../../assets/Excel/Demo_Block_Detailstemplate.xlsx" download><img class="excel" src="../../assets/images/upload.png" tooltip="click to download demo excel format"></a>
                            <input type="file" id="file_upload_id" (change)="onFileChange($event)" multiple="false" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" style="display:none" #file> -->
                        </div>
                </div>
                </div>
                <div class="dash-row" *ngIf='enableBlockListView'>
                    <table class="table table-bordered"
                        [mfData]="allBlocksLists | search:['blBlkName', 'blBlkType', 'blNofUnit']:searchTxt"
                        #mf="mfDataTable" (click)="onPageChange($event)" [mfRowsOnPage]="setnoofrows=='All Records'?allBlocksLists.length:setnoofrows">
                        <thead>
                            <tr>
                                <th>
                                    S.No.
                                </th>
                                <th>
                                    <mfDefaultSorter (click)="removeColumnSort('BlockName')" by="blBlkName">Block Name&nbsp;<i [hidden]="columnName=='BlockName'" class="fa fa-sort"></i></mfDefaultSorter>
                                </th>
                                <th>
                                    <mfDefaultSorter (click)="removeColumnSort('BlockType')" by="blBlkType">Block Type&nbsp;<i [hidden]="columnName=='BlockType'" class="fa fa-sort"></i></mfDefaultSorter>
                                </th>
                                <th>
                                    <mfDefaultSorter (click)="removeColumnSort('NoOfUnits')" by="blNofUnit">No Of Units&nbsp;<i [hidden]="columnName=='NoOfUnits'" class="fa fa-sort"></i></mfDefaultSorter>
                                </th>
                                <th>
                                    Action
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of mf.data;let i=index">
                                <ng-container *ngIf="item == -1">
                                    <td colspan="5" align="center">No Data Found</td>
                                </ng-container>
                                <ng-container *ngIf="item!=-1">
                                    <td class="txt-middle">{{ (PaginatedValue * (p - 1) + i)+1 }}</td>
                                    <td>{{item['blBlkName']}}</td>
                                    <td>{{item['blBlkType']}}</td>
                                    <td class="txt-middle">{{item['blNofUnit']}}</td>
                                    <td class="txt-middle">
                                        <!-- <i style="cursor: pointer;" data-toggle="modal" data-target="#viewBlockDetailsTemplate"
                                            (click)="viewBlockDetails(item['blBlkName'],item['blBlkType'],item['blNofUnit'])"
                                            class="fa fa-eye" tooltip="View Block"></i>
                                            &nbsp;|&nbsp; --><i style="cursor: pointer;" data-toggle="modal"
                                            data-target="#editBlockDetails"
                                            (click)="OpenModal(editBlocktemplate,item.blBlkName,item.blBlkType,item.blNofUnit,item.blMgrName,item.blMgrMobile,item.blMgrEmail,item.asMtType,item.asMtFRate,item.asMtDimBs,item.asUniMsmt,item.asbGnDate,item.asdPyDate,item.bldUpdated,item.aslpcType,item.aslpChrg,item.blBlockID,item.asiCrFreq,item.aslpsDate,item['bldCreated'])"
                                            class="fa fa-pencil" tooltip="Edit Block"></i>

                                    </td>
                                </ng-container>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="5">
                                    <mfBootstrapPaginator></mfBootstrapPaginator>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <!--Dashboard icons end-->
            <!--Add Blocks form Starts-->
            <div class="col-sm-12" *ngIf="enableAddBlocksView">

                <app-add-blocks (EnableBlockListView)="EnableBlockListView($event)"></app-add-blocks>
            </div>
            <!--Add Blocks form Ends-->
        </div>

    </div>
    <!--rightBar start-->
    <!-- <app-right-bar></app-right-bar> -->
    <!--rightBar end-->
</div>



<!-- VIEW BLOCK START HERE -->
<div class="modal fade" id="viewBlockDetailsTemplate" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="padding-top:20px;">
                <h4 class="modal-title" id="myModalLabel"><u>View Block</u></h4>
                <button type="button" class="close" data-dismiss="modal" style="left:100%" aria-label="Close"><span
                        aria-hidden="true">Ã—</span></button>
            </div>
            <div class="modal-body">

                <fieldset class="scheduler-border">
                    <div class="row" style="text-align:center;">
                        <br>
                        <div class="col-sm-4">
                            <p></p>
                            <h4>Block Name: </h4><span>{{bkname}}</span>
                            <p></p>
                            <br>
                        </div>
                        <div class="col-sm-4">
                            <p></p>
                            <h4>Block Type: </h4><span>{{bktype}}</span>
                            <p></p>
                            <br>
                        </div>

                        <div class="col-sm-4">
                            <p></p>
                            <h4>No of Units: </h4><span>{{bknofunit}}</span>
                            <p></p>
                            <br>
                        </div>

                    </div>
                </fieldset>

            </div>
        </div>
    </div>
</div>
<!-- VIEW BLOCK END HERE -->

<ng-template #editBlocktemplate>
    <div class="modal-content">
        <div class="modal-header">
            <h4 class="modal-title" style="padding-left:15px;">Edit Block</h4>
            <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col-sm-12">
                    <form name="editAssociation" #editBlockForm='ngForm' autocomplete="off">
                        <div class="row">
                            <div class="col-sm-8">
                                <div class="from-group" style="padding-left:15px;">
                                    <p>Association Name : <strong>{{assnName}}</strong></p>
                                </div>
                            </div>

                            <div class="col-sm-4" style="padding-right:15px;">
                                <p>Date : <strong> {{myDate | date: 'dd/MM/yyyy'}}
                                    </strong></p>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <hr>
                        </div>
                        <div class="col-sm-12">
                            <h5 style="color:#e59400;">Blocks details</h5>
                        </div>
                        <div class="row" style="padding-left:15px;padding-right:15px;">
                            <div class="col-sm-4 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : blocknameControl.invalid && blocknameControl.touched}">
                                    <label id=label1>Block Name<span class="red">*</span> </label>
                                    <input type="text" name="BLBlkName" id="input1" autocomplete='BLBlkName'
                                        [(ngModel)]="BLBlkName" #blocknameControl="ngModel" class="form-control"
                                        placeholder="Block Name" pattern="[a-zA-Z0-9 _]*" required />
                                    <p class="alerts" *ngIf="blocknameControl.invalid && blocknameControl.touched">Valid
                                        name is required
                                    </p>
                                </div>
                            </div>
                            <div class="col-sm-4 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : blocktypeControl.invalid && blocktypeControl.touched}">
                                    <label id=label2>Block Type<span class="red">*</span></label>

                                    <input list="type" class="form-control" name="BLBlkType" [(ngModel)]="BLBlkType"
                                        #blocktypeControl='ngModel' placeholder="Block Type" required>
                                    <datalist id="type">
                                        <option value="">Select Frequency</option>
                                        <option *ngFor="let blktype of blocktypes" [value]="blktype['name']">
                                            {{blktype['displayName']}}
                                        </option>
                                    </datalist>

                                    <p class="alerts" *ngIf="blocktypeControl.invalid && blocktypeControl.touched">Valid
                                        block type is
                                        required</p>
                                </div>
                            </div>

                            <div class="col-sm-4 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : noofunitsControl.invalid && noofunitsControl.touched}">
                                    <label id=label3>No of Units<span class="red">*</span></label>
                                    <input type="text" name="BLNofUnit" id="input3" autocomplete='BLNofUnit'
                                        [(ngModel)]="BLNofUnit" #noofunitsControl="ngModel" class="form-control"
                                        placeholder="No Of Units" pattern="[0-9]*"/>
                                    <p class="alerts" *ngIf="noofunitsControl.invalid && noofunitsControl.touched">No of
                                        units are required
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <hr>
                        </div>
                        <div class="col-sm-12">
                            <h5 style="color:#e59400;">Manager details</h5>
                        </div>
                        <div class="row" style="padding-left:15px;padding-right:15px;">
                            <div class="col-sm-4 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : managernameControl.invalid && managernameControl.touched}">
                                    <label id=label4>Manager Name<span class="red">*</span></label>
                                    <input type="text" name="BLMgrName" id="input4" autocomplete='BLMgrName'
                                        [(ngModel)]="BLMgrName" #managernameControl="ngModel" class="form-control"
                                        placeholder="Manager Name" pattern="[a-zA-Z]*" required />
                                    <p class="alerts" *ngIf="managernameControl.invalid && managernameControl.touched">
                                        Manager name is
                                        required</p>
                                </div>
                            </div>
                            <div class="col-sm-4 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : managernumberControl.invalid && managernumberControl.touched}">
                                    <label id=label5>Manager Mobile Number<span class="red">*</span></label>
                                    <input type="text" name="BLMgrMobile" id="input5" autocomplete='BLMgrMobile'
                                        [(ngModel)]="BLMgrMobile" #managernumberControl="ngModel" class="form-control"
                                        placeholder="Manager Mobile Number" minlength=10 maxlength=10 pattern="[0-9]*"
                                        required (keypress)=_keyPress($event) />
                                    <p class="alerts"
                                        *ngIf="managernumberControl.invalid && managernumberControl.touched">Manager
                                        mobile
                                        number is
                                        required</p>
                                </div>
                            </div>
                            <div class="col-sm-4 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : manageremailControl.invalid && manageremailControl.touched}">
                                    <label id=label6>Manager Email Id<span class="red">*</span></label>
                                    <input type="text" name="BLMgrEmail" id="input6" autocomplete='BLMgrEmail'
                                        [(ngModel)]="BLMgrEmail" #manageremailControl="ngModel" class="form-control"
                                        placeholder="Manager Email Id"
                                        pattern="[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*"
                                        required />
                                    <p class="alerts"
                                        *ngIf="manageremailControl.invalid && manageremailControl.touched">Manager
                                        email-id is
                                        required
                                    </p>
                                </div>
                            </div>
                        </div>
                        <!-- from here onwards Maintanace details related code -->
                        <!-- <div class="col-sm-12">
                            <hr>
                        </div> -->

                        <!-- <div class="col-sm-12">
                            <h5 style="color:#e59400;">Maintenance details</h5>
                        </div> -->
                        <!-- <div class="row" style="padding-left:15px;padding-right:15px;">
                            <div class="col-sm-4 col-xs-12" *ngIf="addRate == 'flatRatevalue'">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : flatRatevalueControl.invalid && flatRatevalueControl.touched}">
                                    <label>Flat Rate Value<span class="red">*</span></label>
                                    <input class="form-control" type="text" name="ASMtFRate" [(ngModel)]="ASMtFRate"
                                        placeholder="Value" #flatRatevalueControl='ngModel'
                                        pattern="^[+-]?((\.\d+)|(\d+(\.\d+)?))$" required>
                                    <p class="alerts"
                                        *ngIf="flatRatevalueControl.invalid && flatRatevalueControl.touched">Invalid
                                        flat rate
                                    </p>
                                    <small>Amount to be charged</small>
                                </div>
                            </div>
                            <div class="col-sm-3 col-xs-12" *ngIf="addRate1 == 'dimension'">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : maintenanceValueControl.invalid && maintenanceValueControl.touched}">
                                    <label>Maintenance Value<span class="red">*</span></label>
                                    <input class="form-control" type="text" name="ASMtDimBs"
                                        #maintenanceValueControl='ngModel' [(ngModel)]="ASMtDimBs"
                                        placeholder="Maintenance Value " required pattern="^[0-9]+(\.[0-9]{1,2})?$">
                                    <p class="alerts"
                                        *ngIf="maintenanceValueControl.invalid && maintenanceValueControl.touched">
                                        Invalid
                                        Maintenance Value
                                    </p>
                                    <small>Rate (SQFT / SQMTR) </small>
                                </div>
                            </div>
                        </div> -->

                        <!-- <div class="row" style="padding-left:15px;padding-right:15px;">

                            <div class="col-sm-6 col-xs-12">
                                <div class="form-group"
                                    [ngClass]="{'was-validated' : measurementsControl.invalid && measurementsControl.touched}">
                                    <label>Unit of Measurement</label>
                                    <input class="form-control" type="text" required name="ASUniMsmt"
                                        autocomplete="ASUniMsmt" [(ngModel)]="ASUniMsmt" #measurementsControl='ngModel'
                                        placeholder="Measurement Type">
                                    <p class="alerts"
                                        *ngIf="measurementsControl.invalid && measurementsControl.touched">Invalid
                                        Measurement
                                    </p>
                                </div>
                            </div>
                            <div class="col-sm-6 col-xs-12">
                                <div class="form-group">
                                    <label>Invoice Creation Frequency<span class="red">*</span></label>
                                    <input list="invoice" class="form-control" name="ASIcRFreq" [(ngModel)]="ASIcRFreq"
                                        #frequencyControl='ngModel' placeholder="Invoice Creation Frequency" required>
                                    <datalist id="invoice">
                                        <option disabled="true" value="">Select Frequency</option>
                                        <option *ngFor="let frequency of frequencys" [value]="frequency['name']">
                                            {{frequency['displayName']}}
                                        </option>
                                    </datalist>
                                    <p class="alerts" *ngIf="frequencyControl.invalid && frequencyControl.touched">
                                        Invalid Invoice Frequency
                                    </p>
                                </div>
                            </div>
                        </div> -->

                        <!-- <div class="row" style="padding-left:15px;padding-right:15px;">
                            <div class="col-sm-6 col-xs-12">
                                <div class="form-group">
                                    <label>Invoice Generation Date<span class="red">*</span></label>
                                    <input type="text" class="form-control" name="ASBGnDate"
                                        #NextInvoiceGenDateControl='ngModel' placeholder="Invoice Generation Date"
                                        [bsConfig]="bsConfig" [(ngModel)]="ASBGnDate"
                                        (bsValueChange)="onValueChange($event)" bsDatepicker
                                        placement="top" />
                                </div>
                            </div>
                            <div class="col-sm-6 col-xs-12">
                                <div class="form-group">
                                    <label>Due Date<span class="red">*</span></label>
                                    <input type="text" class="form-control" name="ASDPyDate" #DueDateControl='ngModel'
                                        [class.classForInvalid]="enableduedatevalidation" placeholder="Due Date"
                                        [bsConfig]="bsConfig" [(ngModel)]="ASDPyDate" [minDate]="minDate"
                                        (bsValueChange)="onDueDateValueChange($event)" bsDatepicker placement="top" />
                                    <ng-container *ngIf='enableduedatevalidation'>
                                        <p class="invalidFeedback">Due date should be greater than or equal to
                                            invoice date
                                        </p>
                                    </ng-container>
                                </div>
                            </div>
                        </div> -->

                        <!-- <div class="row" style="padding-left:15px;padding-right:15px;">

                            <div class="col-sm-4 col-xs-12">

                                <div class="form-group">

                                    <label>Late Payment Charge Type<span class="red">*</span></label>

                                    <input list="payment" class="form-control" name="ASLPCType"
                                        #latePymtChargeTypeControl='ngModel' [(ngModel)]="ASLPCType"
                                        placeholder="Late Payment Charge Type" required>

                                    <datalist id="payment">

                                        <option disabled="true" value="">Select Charge Type</option>

                                        <option *ngFor='let lpct of latePaymentChargeTypes' [value]="lpct['name']">

                                            {{lpct['displayName']}}

                                        </option>

                                    </datalist>

                                    <p class="alerts"
                                        *ngIf="latePymtChargeTypeControl.invalid && latePymtChargeTypeControl.touched">
                                        Select
                                        Late Payment Charge Type

                                    </p>

                                </div>

                            </div>

                            <div class="col-sm-4 col-xs-12">

                                <div class="form-group"
                                    [ngClass]="{'was-validated' : latePymtChargeControl.invalid && latePymtChargeControl.touched}">

                                    <label>Late Payment Charge<span class="red">*</span></label>

                                    <input class="form-control" type="text" #latePymtChargeControl='ngModel'
                                        name="ASLPChrg" autocomplete="ASLPChrg" [(ngModel)]="ASLPChrg"
                                        placeholder="Late Payment charge" pattern="[0-9]+(\.[0-9][0-9]?)?" required>

                                    <p class="alerts"
                                        *ngIf="latePymtChargeControl.invalid && latePymtChargeControl.touched">Select
                                        Late
                                        Payment Charge

                                    </p>

                                </div>

                            </div>

                            <div class="col-sm-4 col-xs-12">

                                <div class="form-group">

                                    <label>Starts From<span class="red">*</span></label>

                                    <input class="form-control" type="text" class="form-control" name="ASLPSDate"
                                        #StartsFromDateControl='ngModel' placeholder="Starts From Date"
                                        [bsConfig]="bsConfig" [(ngModel)]="ASLPSDate" #startsFromDateCtrl='bsDatepicker'
                                        [minDate]='startsFromMaxDate'
                                        [class.classForInvalid]="enablestartfromdatevalidation"
                                        (bsValueChange)="onStartsFromDateValueChange($event)" [(ngModel)]="ASLPSDate"
                                        #startsFromDateCtrl='bsDatepicker' bsDatepicker placement="top" />
                                    <!-- <p class="invalid-feedback">Select Date</p> -->
                                    <!-- <ng-container *ngIf='enablestartfromdatevalidation'>
                                        <p class="invalidFeedback">Starts from date should be greater than or equal to
                                            due date</p>
                                    </ng-container> -->
                                <!-- </div>

                            </div>

                        </div>  -->

                        <div class="from-group">
                            <div class="form-group pull-right">
                                <button type="submit" [disabled]='editBlockForm.invalid' class="btn btn-primary-purple nextBtn" (click)="UpdateBlock()">Update</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</ng-template>